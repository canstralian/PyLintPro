name: CI Pipeline

on: [push, pull_request]

jobs:
  lint:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'  # Specify the Python version you are using

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install pylint flake8 autopep8 gradio bandit safety

      - name: Run Pylint
        run: |
          pylint $(git ls-files '*.py')

      - name: Run Flake8
        run: |
          flake8 .

      - name: Run Bandit
        run: |
          bandit -r .

      - name: Run Safety
        run: |
          safety check

      - name: Run App
        run: |
          python app.py

  code_review:
    runs-on: ubuntu-latest
    needs: lint

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: LLM Code Review
        uses: luiyen/llm-code-review@1.0.1
        with:
          githubToken: ${{ secrets.GITHUB_TOKEN }}
          apiKey: ${{ secrets.HUGGINGFACE_TOKEN }}
          githubRepository: ${{ github.repository }}
          githubPullRequestNumber: ${{ github.event.pull_request.number }}
          gitCommitHash: ${{ github.event.pull_request.head.sha }}
          repoId: meta-llama/Llama-2-7b-chat-hf
          maxNewTokens: 1024
          temperature: 0.2
          topK: 50
          topP: 0.95
          pullRequestDiff: ${{ github.event.pull_request.diff_url }}
          pullRequestChunkSize: 3500
          logLevel: INFO

  semver_release:
    runs-on: ubuntu-latest
    needs: code_review
